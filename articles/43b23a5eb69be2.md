---
title: "Javaã§é«˜æ©Ÿèƒ½CLIã‚’ä½œã‚‹"
emoji: "ğŸ¦”"
type: "tech"
topics: ["Java", "JLine"]
published: true
---

# ã¯ã˜ã‚ã«

å¤§å­¦ã®èª²é¡Œã§ Java ã§ä½•ã‹ã—ã‚‰ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œã‚Œã€ã¨ã„ã†èª²é¡ŒãŒã‚ã‚Š CLI ã§ä½œã‚‹ã“ã¨ã«ãªã£ãŸã®ã§ãƒªãƒƒãƒãª CLI ã‚’ä½œã‚‹æ–¹æ³•ã‚’æ¢ã—ã¦ã„ã¾ã—ãŸã€‚
ãã—ã¦ JLine ã¨ã„ã†ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®å…¥åŠ›ã‚’æ‰±ã†ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«å‡ºä¼šã£ãŸã®ã§ãã®ä½¿ã„æ–¹ã‚’ã¾ã¨ã‚ã¾ã™ã€‚

# æœ€çµ‚çš„ã«ã§ãã‚ãŒã‚‹ã‚‚ã®

Maven ã‚’ä½¿ã£ã¦å®Ÿè¡Œã—ã¦ã„ã‚‹ãŸã‚ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ãƒ¡ã‚¿çš„ãªæƒ…å ±ãŒå…¥ã‚Šã¾ã™ã€‚
å¾Œè¿°ã™ã‚‹ maven-assembly-plugin ã‚’ä½¿ãˆã°å®Ÿè¡Œå¯èƒ½ jar ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡ºåŠ›ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚
![jline](https://github.com/Key5n/zenn/blob/main/images/jline-difficult.gif?raw=true)

# ç’°å¢ƒ

- Maven
- Java JDK 17

# ç’°å¢ƒæ§‹ç¯‰

1. Maven Project ã‚’ä½œæˆ
   1. VSCode ãªã‚‰ Ctrl + Shift + P
   2. java: Create Java Project
   3. maven-archetype-quickstart
   4. 1.4ï¼ˆ2023-05-28 ç¾åœ¨ï¼‰
   5. ã‚°ãƒ«ãƒ¼ãƒ— ID ã‚’é©å½“ã«å…¥åŠ›ï¼ˆã“ã“ã§ã¯ `com.example` ï¼‰
   6. artifact ID ã‚’é©å½“ã«å…¥åŠ›ï¼ˆã“ã“ã§ã¯ `demo`ï¼‰
   7. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãŒå‡ºã¦ãã¦å…¥åŠ›ã‚’æ±‚ã‚ã‚‰ã‚ŒãŸã‚‰ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼é€£æ‰“ã§ã„ã„ã§ã™
2. JLine ã‚’è¿½åŠ 
   1. Ctrl + Shift + P
   2. maven: add a dependency
   3. jline
   4. org.jline ã® jline ã‚’è¿½åŠ ï¼ˆ2023-05-28ï¼‰ã®æ™‚ç‚¹ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ 3.23.0

ã“ã†ãªã£ãŸã‚‰ OK ã§ã™ã€‚
ãƒ†ã‚¹ãƒˆã®æ–¹ã¯ä»Šå›è§¦ã‚‰ãªã„ãŸã‚æ¶ˆã—ã¦ã„ãŸã ã„ã¦ã‚‚ OK ã§ã™ã€‚

:::details ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
demo
â”œ src
â”‚ â”œ main/java/com/example
â”‚ â”‚ â”” App.java
â”‚ â”” test/java/com/example
â”‚   â”” AppTest.java
â”œ target/ # (ãƒ“ãƒ«ãƒ‰æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«)
â”” pom.xml
```

:::

:::details pom.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>

<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
<modelVersion>4.0.0</modelVersion>

<groupId>com.example</groupId>
<artifactId>demo</artifactId>
<version>1.0-SNAPSHOT</version>

<name>demo</name>

  <!-- FIXME change it to the project's website -->

<url>http://www.example.com</url>

  <properties>
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <maven.compiler.source>1.7</maven.compiler.source>
    <maven.compiler.target>1.7</maven.compiler.target>
  </properties>

  <dependencies>

    <dependency>
      <groupId>org.jline</groupId>
      <artifactId>jline</artifactId>
      <version>3.23.0</version>
    </dependency>

    <dependency>
      <groupId>junit</groupId>
      <artifactId>junit</artifactId>
      <version>4.11</version>
      <scope>test</scope>
    </dependency>

  </dependencies>

  <build>
    <pluginManagement><!-- lock down plugins versions to avoid using Maven defaults (may be moved to parent pom) -->
      <plugins>
        <!-- clean lifecycle, see https://maven.apache.org/ref/current/maven-core/lifecycles.html#clean_Lifecycle -->
        <plugin>
          <artifactId>maven-clean-plugin</artifactId>
          <version>3.1.0</version>
        </plugin>
        <!-- default lifecycle, jar packaging: see https://maven.apache.org/ref/current/maven-core/default-bindings.html#Plugin_bindings_for_jar_packaging -->
        <plugin>
          <artifactId>maven-resources-plugin</artifactId>
          <version>3.0.2</version>
        </plugin>
        <plugin>
          <artifactId>maven-compiler-plugin</artifactId>
          <version>3.8.0</version>
        </plugin>
        <plugin>
          <artifactId>maven-surefire-plugin</artifactId>
          <version>2.22.1</version>
        </plugin>
        <plugin>
          <artifactId>maven-jar-plugin</artifactId>
          <version>3.0.2</version>
        </plugin>
        <plugin>
          <artifactId>maven-install-plugin</artifactId>
          <version>2.5.2</version>
        </plugin>
        <plugin>
          <artifactId>maven-deploy-plugin</artifactId>
          <version>2.8.2</version>
        </plugin>
        <!-- site lifecycle, see https://maven.apache.org/ref/current/maven-core/lifecycles.html#site_Lifecycle -->
        <plugin>
          <artifactId>maven-site-plugin</artifactId>
          <version>3.7.1</version>
        </plugin>
        <plugin>
          <artifactId>maven-project-info-reports-plugin</artifactId>
          <version>3.0.0</version>
        </plugin>
      </plugins>
    </pluginManagement>
  </build>
</project>
```

:::

# TAB ã‚­ãƒ¼ã«ã‚ˆã‚‹è£œå®Œã®å®Ÿè£…

ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ 1 ã¤è¿½åŠ ã—ã¾ã™ã€‚

```diff
 demo
 â”œ src
 â”‚ â”œ main/java/com/example
+â”‚ â”‚ â”œ UtilizedTerminal.java
 â”‚ â”‚ â”” App.java
 â”‚ â”” test/java/com/example
 â”‚   â”” AppTest.java
 â”œ target/ # (ãƒ“ãƒ«ãƒ‰æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«)
 â”” pom.xml
```

```java:UtilizedTerminal.java
package com.example;

import java.io.IOException;
import java.util.*;

import org.jline.builtins.Completers.TreeCompleter;
import org.jline.console.CmdDesc;
import org.jline.reader.*;
import org.jline.reader.impl.DefaultParser;
import org.jline.terminal.*;

public class UtilizedTerminal {

  public static LineReader initializeTerminal() {
    // ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚„è§£æã®è¨­å®š
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚‚ã®ã‚’ä½¿ç”¨
    Parser parser = new DefaultParser();

    // è£œå®Œã®è¨­å®š
    Completer completer = createCompleter();
    try (Terminal terminal = TerminalBuilder.terminal()) {
      LineReader reader = LineReaderBuilder.builder().terminal(terminal).completer(completer).parser(parser)
          .build();
      showMessages();

      return reader;
    } catch (IOException e) {
      e.printStackTrace();
    }
    return null;
  }

  private static Completer createCompleter() {
    Completer completer = new TreeCompleter(TreeCompleter.node("hoge", TreeCompleter.node("--fuga", "--bar")));

    return completer;
  }

  private static void showMessages() {
    System.out.println("æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã£ã¦ãã ã•ã„");
    System.out.println("TABã‚­ãƒ¼ã‚‚ä½¿ãˆã¾ã™");
    System.out.println("ã‚³ãƒãƒ³ãƒ‰: hoge");
  }
}

```

```java:App.java
package com.example;

import org.jline.reader.LineReader;
import org.jline.reader.UserInterruptException;

public class App {
  public static void main(String[] args) {
    LineReader reader = UtilizedTerminal.initializeTerminal();

    try {
      while (true) {
        String line = reader.readLine("===> ");
        System.out.println(line);
      }
    } catch (UserInterruptException _) {
      System.out.println("å‡¦ç†ãŒä¸­æ–­ã•ã‚Œã¾ã—ãŸ");
    }
  }
}

```

å®Ÿè¡Œæ–¹æ³•

```sh
# com.example ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã® App ã‚¯ãƒ©ã‚¹ã® main ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‹•ä½œ
mvn exec:java -Dexec.mainClass=com.example.App
```

ç¾åœ¨`App`ã‚¯ãƒ©ã‚¹ã¯å…¥åŠ›ã‚’ãã®ã¾ã¾è¿”ã™ã ã‘ã§ã™ã€‚

æµã‚Œã‚’èª¬æ˜ã™ã‚‹ã¨ã€å…¥åŠ›ã‚’èª­ã¿å–ã‚‹ã®ã«`Terminal`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨`Parser`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã€`Completer`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¨­å®šã—ã¾ã™ã€‚
ãã‚Œã‚’ â†“ ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§å…¥åŠ›ã‚’èª­ã¿å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
`readLine`ãƒ¡ã‚½ãƒƒãƒ‰ã®å¼•æ•° `===>` ã¯ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è¡¨ç¤ºã—ãŸã¨ãã«å‡ºã¦ãã‚‹ã‚‚ã®ã§ã™ã€‚
å¥½ããªã‚‚ã®ã‚’è¡¨ç¤ºã—ã¦ãã ã•ã„ã€‚

```java
LineReader reader = LineReaderBuilder.builder().terminal(terminal).completer(completer).parser(parser)
    .build();
// å…¥åŠ›ã•ã‚ŒãŸæ–‡å­—
String line = reader.readLine("===> ");
```

å¿…é ˆãªã®ã¯`Terminal`ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã ã‘ã§ã™ã€‚
:::details ä¾‹

```java
  Terminal terminal = ...;
  LineReader lineReader = LineReaderBuilder.builder()
                              .terminal(terminal)
                              .build();
```

:::

å®Ÿè¡Œã™ã‚‹ã¨ã“ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
![jlineï¼ˆè£œå®Œã®ã¿ï¼‰](https://github.com/Key5n/zenn/blob/main/images/jline-easy.gif?raw=true)

# è£œå®Œæ©Ÿèƒ½ã‚’ç·¨é›†

è£œå®Œã® CLI ã‚’å°‘ã—è¤‡é›‘ã«ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

ä»Šã¾ã§ã¯ã“ã®ã‚³ãƒãƒ³ãƒ‰ã ã‘ã§ã—ãŸã€‚

```sh
$ hoge --fuga
$ hoge --bar
```

ã“ã‚Œã‚’è£œå®Œæ©Ÿèƒ½ã®èª¬æ˜ã®ãŸã‚ã«ã€ã“ã®ã‚ˆã†ãªã‚‚ã®ãŒå¯èƒ½ã«ãªã‚‹ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚

```sh
$ hoge --fuga foo
$ hoge --bar baz
```

```diff java:UtilizedTerminal.java
 package com.example;

 import java.io.IOException;

 import org.jline.builtins.Completers.TreeCompleter;
 import org.jline.reader.*;
 import org.jline.reader.impl.DefaultParser;
 import org.jline.terminal.*;

 public class UtilizedTerminal {

   public static LineReader initializeTerminal() {
     Parser parser = new DefaultParser();
     Completer completer = createCompleter();
     try (Terminal terminal = TerminalBuilder.terminal()) {
       LineReader reader = LineReaderBuilder.builder().terminal(terminal).completer(completer).parser(parser)
           .build();
       showMessages();

       return reader;
     } catch (IOException e) {
       e.printStackTrace();
     }
     return null;
   }

   private static Completer createCompleter() {
-    Completer completer = new TreeCompleter(TreeCompleter.node("hoge", TreeCompleter.node("--fuga", "--bar")));
+     Completer completer = new TreeCompleter(
+         TreeCompleter.node(
+             "hoge",
+             TreeCompleter.node("--fuga", TreeCompleter.node("foo")),
+             TreeCompleter.node("--bar", TreeCompleter.node("baz"))));

     return completer;
   }

   private static void showMessages() {
     System.out.println("æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã£ã¦ãã ã•ã„");
     System.out.println("TABã‚­ãƒ¼ã‚‚ä½¿ãˆã¾ã™");
     System.out.println("ã‚³ãƒãƒ³ãƒ‰: hoge");
   }
 }

```

ã‚„ã£ã¦ã„ã‚‹ã“ã¨ã¯åˆ†ã‹ã‚Šã‚„ã™ã„ã¨æ€ã„ã¾ã™ã€‚

ä¸€å¿œèª¬æ˜ã—ã¾ã™ã€‚
ä»Šå›`hoge` ãƒãƒ¼ãƒ‰ã®ä¸‹ã«ã¯`--fuga`ãƒãƒ¼ãƒ‰ã¨`--bar`ãƒãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã™ã€‚
`--fuga`ãƒãƒ¼ãƒ‰ã«ã¯`foo`ãƒãƒ¼ãƒ‰ã€`--bar`ãƒãƒ¼ãƒ‰ã«ã¯`baz`ãƒãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã™ã€‚

æ–‡æ³•ã¨ã—ã¦ã¯ã¤ã¾ã‚Šã“ã†ã„ã†ã“ã¨ã§ã™ã€‚

```java
TreeCompleter.node("ãƒãƒ¼ãƒ‰å", "å­ãƒãƒ¼ãƒ‰")
```

å­ãƒãƒ¼ãƒ‰ã«ã¯ã•ã‚‰ã«å­ãƒãƒ¼ãƒ‰ï¼ˆå­«ãƒãƒ¼ãƒ‰ï¼‰ãŒã‚ã£ã¦ãã®ä¸‹ã«ã¯ã•ã‚‰ã«å­ãƒãƒ¼ãƒ‰ãŒ...ã¨ã„ã†ã“ã¨ã§ã™ã€‚

æ–°ãŸã«è¶³ã—ãŸã„ã¨æ€ã£ãŸã‚‰ã€ã“ã“ã«ä»˜ã‘è¶³ã›ã°ã‚ˆã„ã®ã§ã™ã­ã€‚

:::details ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã‚’è¦‹ã¦ã„ã¦è©°ã¾ã£ãŸã¨ã“ã‚

ã“ã® TreeComplterï¼ˆæœ¨æ§‹é€ ã«ã‚ˆã‚‹è£œå®Œï¼‰ã®éƒ¨åˆ†ã®ã‚µãƒ³ãƒ—ãƒ«ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯æ¬¡ã®ã‚ˆã†ã«æ›¸ã‹ã‚Œã¦ã„ã¾ã—ãŸã€‚

```java
completer = new TreeCompleter(
    node("Command1",
        node("Option1",
            node("Param1", "Param2")),
        node("Option2"),
        node("Option3")));
```

ã§ã™ãŒã“ã®é€šã‚Šã«ã‚„ã‚‹ã¨
`The method node(String, Completers.TreeCompleter.Node) is undefined for the type UtilizedTerminalï¼ˆä»Šå›ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ã‚¯ãƒ©ã‚¹åï¼‰`
ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ã™ã€‚
ã“ã®ã‚¨ãƒ©ãƒ¼ã®é€šã‚Šã€`node`ã¯ãã®ã‚¯ãƒ©ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¨ã—ã¦åˆ¤å®šã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚
æ­£ã—ãã¯`TreeCompleter`ã®ãƒ¡ã‚½ãƒƒãƒ‰ãªã®ã§ã€

```
TreeCompleter.node("ãƒãƒ¼ãƒ‰å");
```

ã¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ã¡ã‚‡ã£ã¨è€ƒãˆã‚Œã°ã‚ã‹ã‚‹ã“ã¨ã§ã—ã‚‡ã†ãŒã€Java ã«æ…£ã‚Œã¦ã„ãªã„åƒ•ã¯é¨™ã•ã‚Œã¾ã—ãŸã€‚
:::

:::details è£œå®Œã«ã¤ã„ã¦
è£œå®Œã«ã¯è‰²ã€…ãªã‚‚ã®ãŒä½¿ãˆã¾ã™ã€‚

ä¾‹

- æœ¨æ§‹é€ ã«ã‚ˆã‚‹è£œå®Œï¼ˆä»Šå›ä½¿ç”¨ï¼‰
- æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹è£œå®Œ
- ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’ã‚µã‚¸ã‚§ã‚¹ãƒˆã™ã‚‹ã“ã¨ã«ã‚ˆã‚‹è£œå®Œ

CLI ã‚’ä½œã‚‹ã«ã‚ãŸã‚Šã€æœ€åˆã¯æ­£è¦è¡¨ç¾ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã—ãŸã€‚
ã§ã™ãŒæ­£è¦è¡¨ç¾ã ã¨ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®è¦‹æ „ãˆãŒã¨ã¦ã‚‚æ‚ªã‹ã£ãŸã§ã™ã€‚
ãã‚Œã¨æ€ã£ãŸã‚ˆã†ã«æ©Ÿèƒ½ã—ãªã‹ã£ãŸãŸã‚ã€æœ¨æ§‹é€ ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚
æ­£è¦è¡¨ç¾ã«ã¤ã„ã¦ã¯å¾Œè¿°ã—ã¾ã™ã€‚
:::

:::details æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹è£œå®Œ

è£œå®Œã«ã‚‚è‰²ã€…ã‚ã‚Šã¾ã™ã€‚
æ­£è¦è¡¨ç¾ã ã‘ç´¹ä»‹ã—ã¾ã™ã€‚

````java
Map<String, Completer> comp = new HashMap<>();
comp.put("C1", new StringsCompleter("cmd1"));
comp.put("C11", new StringsCompleter("--opt11", "--opt12"));
comp.put("C12", new StringsCompleter("arg11", "arg12", "arg13"));
comp.put("C2", new StringsCompleter("cmd2"));
comp.put("C21", new StringsCompleter("--opt21", "--opt22"));
comp.put("C22", new StringsCompleter("arg21", "arg22", "arg23"));
completer = new Completers.RegexCompleter("C1 C11* C12+ | C2 C21* C22+", comp::get);

:::

# è‡ªå‹•ã‚µã‚¸ã‚§ã‚¹ãƒˆ

ä»Šã¾ã§ã¯ TAB ã‚­ãƒ¼ã‚’æŠ¼ã™ã¨é¸æŠè‚¢ãŒç¾ã‚Œã‚‹ã€ã¨ã„ã†ã‚‚ã®ã§ã—ãŸã€‚
ã“ã‚Œã‚’**ã‚¿ã‚¤ãƒ—ã—ã¦ã„ã‚‹ã¨è‡ªå‹•ã§å€™è£œãŒè¡¨ç¤ºã•ã‚Œã‚‹**ã¨ã„ã†ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚

```diff java:UtilizedTerminal.java
 package com.example;

 import java.io.IOException;

 import java.util.Arrays;
 import java.util.HashMap;
 import java.util.List;
 import java.util.Map;

 import org.jline.builtins.Completers.TreeCompleter;
 import org.jline.console.ArgDesc;
 import org.jline.console.CmdDesc;
 import org.jline.reader.*;
 import org.jline.reader.impl.DefaultParser;
 import org.jline.terminal.*;
 import org.jline.utils.AttributedString;
 import org.jline.utils.AttributedStyle;
 import org.jline.widget.TailTipWidgets;
 import org.jline.widget.TailTipWidgets.TipType;

 public class UtilizedTerminal {

   public static LineReader initializeTerminal() {
     Parser parser = new DefaultParser();
     Completer completer = createCompleter();
     try (Terminal terminal = TerminalBuilder.terminal()) {
       LineReader reader = LineReaderBuilder.builder().terminal(terminal).completer(completer).parser(parser)
           .build();
       showMessages();

+ã€€ã€€ã€€ã€€// ã‚³ãƒãƒ³ãƒ‰ã€ã‚³ãƒãƒ³ãƒ‰ã®èª¬æ˜ã®ãƒãƒƒãƒ—
+      // èª¬æ˜ã®éƒ¨åˆ†ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®èª¬æ˜ã‚’åŠ ãˆã‚‹ã€‚
+      Map<String, CmdDesc> tailTips = new HashMap<>();
+      // hogeã‚³ãƒãƒ³ãƒ‰ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼šã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã«ç¾ã‚Œã‚‹éƒ¨åˆ†ã®è¨­å®š
+      Map<String, List<AttributedString>> hogeWidgetOpts = new HashMap<>();
+      // --fuga ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®èª¬æ˜
+      hogeWidgetOpts.put("--fuga", Arrays.asList(new AttributedString("ãµãŒã®èª¬æ˜æ–‡")));
+      // --bar ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®èª¬æ˜
+      hogeWidgetOpts.put("--bar", Arrays.asList(new AttributedString("ã°ãƒ¼ã®èª¬æ˜æ–‡")));
+
+      // hoge ã‚³ãƒãƒ³ãƒ‰è‡ªä½“ã®èª¬æ˜
+      // æ–‡å­—ã«è‰²ã‚’ä»˜ã‘ã¦è¡¨ç¤º
+      List<AttributedString> hogeMainDesc = Arrays
+          .asList(new AttributedString("hogeã‚³ãƒãƒ³ãƒ‰ã®èª¬æ˜æ–‡", AttributedStyle.DEFAULT.foreground(AttributedStyle.BRIGHT)));
+
+      tailTips.put("hoge",
+          new CmdDesc(hogeMainDesc, ArgDesc.doArgNames(Arrays.asList("")), hogeWidgetOpts));
+
+      // è£œå®Œã®æœ€å¤§ã‚µã‚¸ã‚§ã‚¹ãƒˆæ•°ã¯5
+      TailTipWidgets tailtipHogeWidgets = new TailTipWidgets(reader, tailTips, 5, TipType.COMPLETER);
+       // è‡ªå‹•ã‚µã‚¸ã‚§ã‚¹ãƒˆæ©Ÿèƒ½ã®æœ‰åŠ¹åŒ–
+      tailtipHogeWidgets.enable();
      return reader;
    } catch (IOException e) {
      e.printStackTrace();
    }
    return null;
  }

  private static Completer createCompleter() {
    Completer completer = new TreeCompleter(
        TreeCompleter.node(
            "hoge",
            TreeCompleter.node("--fuga", TreeCompleter.node("foo")),
            TreeCompleter.node("--bar", TreeCompleter.node("baz"))));

    return completer;
  }

  private static void showMessages() {
    System.out.println("æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã£ã¦ãã ã•ã„");
    System.out.println("TABã‚­ãƒ¼ã‚‚ä½¿ãˆã¾ã™");
    System.out.println("ã‚³ãƒãƒ³ãƒ‰: hoge");
  }
}

````

ã‚„ã£ã¦ã„ã‚‹ã“ã¨ãŒã‚„ã‚„ã“ã—ãæ„Ÿã˜ã¾ã™ã­ã€‚
å¤§ã¾ã‹ã«æŠœãå‡ºã™ã¨ã“ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```Java
// è£œå®Œã®æœ€å¤§ã‚µã‚¸ã‚§ã‚¹ãƒˆæ•°ã¯5
TailTipWidgets tailtipHogeWidgets = new TailTipWidgets(
  ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®å…¥åŠ›,
  ã‚³ãƒãƒ³ãƒ‰ã«å¯¾ã—ã¦ãã®èª¬æ˜,
  æœ€å¤§è¡¨ç¤ºæ•°,
  è¡¨ç¤ºæ–¹æ³•ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³);

 // è‡ªå‹•ã‚µã‚¸ã‚§ã‚¹ãƒˆæ©Ÿèƒ½ã®æœ‰åŠ¹åŒ–
tailtipHogeWidgets.enable();
```

ç°¡å˜ã«è¨€ã†ã¨ã€ã“ã®`ã‚³ãƒãƒ³ãƒ‰ã«å¯¾ã—ã¦ãã®èª¬æ˜`ã¨ã„ã†å¼•æ•°éƒ¨åˆ†ã«ã€ã‚³ãƒãƒ³ãƒ‰ã¨ãã®ã‚³ãƒãƒ³ãƒ‰ã«å¯¾ã™ã‚‹èª¬æ˜ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã‚’å……ã¦ã‚‹ã ã‘ã§ã™ã€‚

ã“ã“ã ã‘è¦‹ã‚‹ã¨ç°¡å˜ã§ã™ãŒã€ãƒ¡ã‚¤ãƒ³éƒ¨åˆ†ã¯ã‚„ã‚„ã“ã—ãè¦‹ãˆã¾ã™ã­ã€‚
ãªãœã‚„ã‚„ã“ã—ãè¦‹ãˆã‚‹ã®ã‹ã¨ã„ã†ã¨ã€`ã‚³ãƒãƒ³ãƒ‰ã«å¯¾ã™ã‚‹èª¬æ˜`ã¨ã„ã†ãƒãƒƒãƒ”ãƒ³ã‚°ã® Value éƒ¨åˆ†ã«ã€ã•ã‚‰ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«å¯¾ã™ã‚‹èª¬æ˜ã®ãƒãƒƒãƒ”ãƒ³ã‚°ãŒä»˜ã‘åŠ ãˆã‚‰ã‚Œã¦ã„ã‚‹ã‹ã‚‰ã ã¨æ€ã„ã¾ã™ã€‚ï¼ˆã“ã“ã§ã¯ hogeWidgetOptsï¼‰
ã“ã“ã‚’åˆ†é›¢ã™ã‚‹ã¨å˜ç´”æ˜å¿«ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚

:::details æ–‡å­—ã®è‰²ã®å¤‰æ›´

ã“ã“ã§`hogeã‚³ãƒãƒ³ãƒ‰ã®èª¬æ˜æ–‡`ã¨ã„ã†æ–‡å­—ã«è‰²ã‚’ä»˜ã‘ã¦è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚
`AttributedString`ã‚¯ãƒ©ã‚¹ã¯ JLine ã®ã‚¯ãƒ©ã‚¹ã® 1 ã¤ã§ã™ã€‚
ã“ã®ã‚ˆã†ã«è¡¨ç¤ºã™ã‚‹è‰²ã‚’å¤‰æ›´ã™ã‚‹ã®ã«ä½¿ç”¨ã§ãã¾ã™ã€‚

```java
// hoge ã‚³ãƒãƒ³ãƒ‰è‡ªä½“ã®èª¬æ˜
// æ–‡å­—ã«è‰²ã‚’ä»˜ã‘ã¦è¡¨ç¤º
List<AttributedString> hogeMainDesc = Arrays
    .asList(new AttributedString("hogeã‚³ãƒãƒ³ãƒ‰ã®èª¬æ˜æ–‡", AttributedStyle.DEFAULT.foreground(AttributedStyle.BRIGHT)));
```

:::

## ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚µã‚¸ã‚§ã‚¹ãƒˆ

ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚µã‚¸ã‚§ã‚¹ãƒˆã¨ã¯ã€ã‚«ãƒ¼ã‚½ãƒ«å¾Œã‚ã«å€™è£œã‚’ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã§ã‚µã‚¸ã‚§ã‚¹ãƒˆã™ã‚‹ã“ã¨ã§ã™ã€‚

JLine ã«ã“ã®æ©Ÿèƒ½ã®ãƒ“ã‚·ãƒƒã¨ã—ãŸåå‰ã¯ãªãã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯ã€Œã‚«ãƒ¼ã‚½ãƒ«ã®å¾Œã‚ã®å¼•æ•°ã®ã‚µã‚¸ã‚§ã‚¹ãƒˆã€ã¨æ›¸ã„ã¦ã‚ã‚Šã¾ã—ãŸã€‚
ã‚„ã‚„ã“ã—ã„ã®ã§ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚µã‚¸ã‚§ã‚¹ãƒˆã¨ä»®ç§°ã™ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚

ã“ã‚Œã®å®Ÿç¾ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã™ã‚‹ã ã‘ã§ã™ã€‚

```diff java:UtilizedTerminal.java
 package com.example.UtilizedTerminal;

 import java.io.IOException;

 import java.util.Arrays;
 import java.util.HashMap;
 import java.util.List;
 import java.util.Map;

 import org.jline.builtins.Completers.TreeCompleter;
 import org.jline.console.ArgDesc;
 import org.jline.console.CmdDesc;
 import org.jline.reader.*;
 import org.jline.reader.impl.DefaultParser;
 import org.jline.terminal.*;
 import org.jline.utils.AttributedString;
 import org.jline.utils.AttributedStyle;
 import org.jline.widget.TailTipWidgets;
 import org.jline.widget.TailTipWidgets.TipType;

 public class UtilizedTerminal {

   public static LineReader initializeTerminal() {
     Parser parser = new DefaultParser();
     Completer completer = createCompleter();
     try (Terminal terminal = TerminalBuilder.terminal()) {
       LineReader reader = LineReaderBuilder.builder().terminal(terminal).completer(completer).parser(parser)
           .build();
       showMessages();

       Map<String, CmdDesc> tailTips = new HashMap<>();
       Map<String, List<AttributedString>> hogeWidgetOpts = new HashMap<>();
       hogeWidgetOpts.put("--fuga", Arrays.asList(new AttributedString("ãµãŒã®èª¬æ˜æ–‡")));
       hogeWidgetOpts.put("--bar", Arrays.asList(new AttributedString("ã°ãƒ¼ã®èª¬æ˜æ–‡")));

       List<AttributedString> hogeMainDesc = Arrays
           .asList(new AttributedString("hogeã‚³ãƒãƒ³ãƒ‰ã®èª¬æ˜æ–‡", AttributedStyle.DEFAULT.foreground(AttributedStyle.BRIGHT)));

-      tailTips.put("hoge", new CmdDesc(hogeMainDesc, ArgDesc.doArgNames(Arrays.asList("")), hogeWidgetOpts));
+      tailTips.put("hoge", new CmdDesc(hogeMainDesc, ArgDesc.doArgNames(Arrays.asList("[pN...]")), hogeWidgetOpts));
      TailTipWidgets tailtipHogeWidgets = new TailTipWidgets(reader, tailTips, 5, TipType.COMPLETER);
      tailtipHogeWidgets.enable();
      return reader;
    } catch (IOException e) {
      e.printStackTrace();
    }
    return null;
  }

  private static Completer createCompleter() {
    Completer completer = new TreeCompleter(
        TreeCompleter.node(
            "hoge",
            TreeCompleter.node("--fuga", TreeCompleter.node("foo")),
            TreeCompleter.node("--bar", TreeCompleter.node("baz"))));

    return completer;
  }

  private static void showMessages() {
    System.out.println("æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã£ã¦ãã ã•ã„");
    System.out.println("TABã‚­ãƒ¼ã‚‚ä½¿ãˆã¾ã™");
    System.out.println("ã‚³ãƒãƒ³ãƒ‰: hoge");
  }
}

```

ã“ã†ã™ã‚‹ã“ã¨ã§ã€`hoge`ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¦ã„ã‚‹é–“ã¯ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã«`[pN...]`ã¨ã„ã†æ–‡å­—åˆ—ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

ã¡ãªã¿ã«ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã”ã¨ã«è¡¨ç¤ºã•ã‚Œã‚‹æ–‡å­—ã‚’å¤‰æ›´ã—ãŸã‹ã£ãŸã®ã§ã™ãŒã€ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚
[ã“ã®ãƒ‡ãƒ¢](https://asciinema.org/a/274600?t=15)ã®ã‚ˆã†ã«ã‚„ã‚ŠãŸã‹ã£ãŸã®ã§ã™ãŒè‹¦é—˜ã®æœ«ã€æ•—åŒ—ã—ã¾ã—ãŸã€‚
ã‚‚ã—ã”å­˜çŸ¥ã®æ–¹ã¯æ•™ãˆã¦ãã ã•ã‚‹ã¨å¹¸ã„ã§ã™ã€‚

æœ€çµ‚çš„ã«ã¯ã“ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
![jline](https://github.com/Key5n/zenn/blob/main/images/jline-difficult.gif?raw=true)

# è¡¨ç¤ºã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

ã‚µã‚¸ã‚§ã‚¹ãƒˆã®æ–¹æ³•ã‚’ 3 ç¨®é¡è¨­å®šã§ãã¾ã™ã€‚

1. COMPLETER

   - ã‚¿ãƒ–è£œå®Œã‚’è¡¨ç¤º
   - ã‚«ãƒ¼ã‚½ãƒ«å¾Œã‚ã®ã‚µã‚¸ã‚§ã‚¹ãƒˆã‚’éè¡¨ç¤º

1. TAIL_TIP

   - ã‚¿ãƒ–è£œå®Œã‚’éè¡¨ç¤º
   - ã‚«ãƒ¼ã‚½ãƒ«å¾Œã‚ã®ã‚µã‚¸ã‚§ã‚¹ãƒˆã‚’è¡¨ç¤º

1. COMBINED
   - ã‚¿ãƒ–è£œå®Œã€ã‚«ãƒ¼ã‚½ãƒ«å¾Œã‚ã®ã‚µã‚¸ã‚§ã‚¹ãƒˆä¸¡æ–¹ã‚’è¡¨ç¤º

[ä¾‹](https://github.com/jline/jline3/wiki/Autosuggestions#configuration)

```java
TailTipWidgets tailtipWidgets = new TailTipWidgets(reader, tailTips, 0, TipType.TAIL_TIP);
TailTipWidgets tailtipWidgets = new TailTipWidgets(reader, tailTips, 0, TipType.COMPLETER);
```

:::details å®Ÿè¡Œå¯èƒ½ jar ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹æ–¹æ³•
maven-assembly-plugin ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```diff xml:pom.xml
<?xml version="1.0" encoding="UTF-8"?>

<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
  <modelVersion>4.0.0</modelVersion>

  <groupId>com.example</groupId>
  <artifactId>demo</artifactId>
  <version>1.0-SNAPSHOT</version>

  <name>demo</name>
  <!-- FIXME change it to the project's website -->
  <url>http://www.example.com</url>

  <properties>
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <maven.compiler.source>1.7</maven.compiler.source>
    <maven.compiler.target>1.7</maven.compiler.target>
  </properties>

  <dependencies>

    <dependency>
      <groupId>org.jline</groupId>
      <artifactId>jline</artifactId>
      <version>3.23.0</version>
    </dependency>

    <dependency>
      <groupId>junit</groupId>
      <artifactId>junit</artifactId>
      <version>4.11</version>
      <scope>test</scope>
    </dependency>
  </dependencies>

  <build>
+    <plugins>
+      <plugin>
+        <artifactId>maven-assembly-plugin</artifactId>
+        <version>3.5.0</version>
+        <configuration>
+          <archive>
+            <manifest>
+              <mainClass>com.example.App</mainClass>
+            </manifest>
+          </archive>
+          <descriptorRefs>
+            <descriptorRef>jar-with-dependencies</descriptorRef>
+          </descriptorRefs>
+        </configuration>
+        <executions>
+          <execution>
+            <id>make-assembly</id>
+            <phase>package</phase>
+            <goals>
+              <goal>single</goal>
+            </goals>
+          </execution>
+        </executions>
+        </plugin>
+    </plugins>
    <pluginManagement><!-- lock down plugins versions to avoid using Maven defaults (may be moved to parent pom) -->
      <plugins>
        <!-- clean lifecycle, see https://maven.apache.org/ref/current/maven-core/lifecycles.html#clean_Lifecycle -->
        <plugin>
          <artifactId>maven-clean-plugin</artifactId>
          <version>3.1.0</version>
        </plugin>
        <!-- default lifecycle, jar packaging: see https://maven.apache.org/ref/current/maven-core/default-bindings.html#Plugin_bindings_for_jar_packaging -->
        <plugin>
          <artifactId>maven-resources-plugin</artifactId>
          <version>3.0.2</version>
        </plugin>
        <plugin>
          <artifactId>maven-compiler-plugin</artifactId>
          <version>3.8.0</version>
        </plugin>
        <plugin>
          <artifactId>maven-surefire-plugin</artifactId>
          <version>2.22.1</version>
        </plugin>
        <plugin>
          <artifactId>maven-jar-plugin</artifactId>
          <version>3.0.2</version>
        </plugin>
        <plugin>
          <artifactId>maven-install-plugin</artifactId>
          <version>2.5.2</version>
        </plugin>
        <plugin>
          <artifactId>maven-deploy-plugin</artifactId>
          <version>2.8.2</version>
        </plugin>
        <!-- site lifecycle, see https://maven.apache.org/ref/current/maven-core/lifecycles.html#site_Lifecycle -->
        <plugin>
          <artifactId>maven-site-plugin</artifactId>
          <version>3.7.1</version>
        </plugin>
        <plugin>
          <artifactId>maven-project-info-reports-plugin</artifactId>
          <version>3.0.0</version>
        </plugin>
      </plugins>
    </pluginManagement>
  </build>
</project>

```

æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚

```sh
mvn clean package
```

ãã†ã™ã‚‹ã¨`target/`ã®ãªã‹ã«`demo-1.0-SNAPSHOT-jar-with-dependencies.jar`ãƒ•ã‚¡ã‚¤ãƒ«ãŒã§ãã¾ã™ã€‚

ã“ã‚Œã«ãƒ‘ã‚¹ã‚’é€šã—ã¦å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```sh
# ä¾‹
java -jar target/demo-1.0-SNAPSHOT-jar-with-dependencies.jar
```

:::

# çµ‚ã‚ã‚Š

ä½¿ã£ãŸæ„Ÿæƒ³ã§ã™ãŒã€**ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‹ã‚‰ Zsh ã®è£œå®Œæ©Ÿèƒ½ã®ã‚ˆã†ãªã‚‚ã®ã‚’ä½œæˆã§ãã‚‹**ã¨ã„ã†ã®ã¯é¢ç™½ã‹ã£ãŸã§ã™ã€‚

å°‘ã€…æ„šç—´ã‚’è¨€ã†ãªã‚Œã°ã€ä¸€ä½“èª°ã®å½¹ã«ç«‹ã¤ã®ã ã‚ã†ã‹ã¨æ€ã„ãªãŒã‚‰æ›¸ã„ã¦ã„ã¾ã—ãŸã€‚

å‚è€ƒæ–‡çŒ®å°‘ãªã™ãã¦è‹¦åŠ´ã—ãŸãŸã‚ã€ä¸€å¿œã¾ã¨ã‚ã¾ã—ãŸã€‚
ãŠå½¹ã«ç«‹ã¦ã°å¹¸ã„ã§ã™ã€‚

ãœã²å¤§å­¦ã®èª²é¡Œã«ã§ã‚‚ä½¿ã£ã¦èº«å†…ã«ã¡ã‚‡ã£ã¨ã ã‘è‡ªæ…¢ã—ã¦ãã ã•ã„ã€‚
